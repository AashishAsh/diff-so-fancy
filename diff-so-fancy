#!/usr/bin/env bash

get_script_dir () {
	src="${BASH_SOURCE[0]}"

	while [[ -h "$src" ]]; do
		dir="$(cd -P "$( dirname "$src" )" && pwd)"
		src="$(readlink "$src")"
		[[ $src != /* ]] && src="$dir/$src"
	done

	dir="$(cd -P "$( dirname "$src" )" && pwd)"
	echo "$dir"
}

call_dsf () {
	"$(get_script_dir)/libexec/diff-so-fancy.pl" "$@"
}

call_dh () {
	# find my diff-highlight
	if hash diff-highlight 2> /dev/null; then
		"diff-highlight"
	else
		"$(get_script_dir)/third_party/diff-highlight/diff-highlight"
	fi
}

################################################################################

# Check to see if there is an STDIN
if [[ ! -t 0 ]]; then
	call_dh | call_dsf
# We've been called stand-alone, pass options directly through
else
	call_dsf "$@"
	exit
fi
